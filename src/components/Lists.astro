---
import Card from '../components/Card.astro';
let lists = [];
let pageSize = 30;
let count = 0;
const searchVal = Astro.url.searchParams.get('s') || '';
try {
    const response = await fetch(`${Astro.url.origin}/api/get?keyword=${searchVal}`);
    if (response.ok) {
        const json = await response.json();
        lists = json.data.lists;
        pageSize = json.data.page_size;
    }
    const countRes = await fetch(`${Astro.url.origin}/api/get-count?keyword=${searchVal}`);
    if (countRes.ok) {
        const json = await countRes.json();
        // count = +json.data.count;
    }
} catch (error) {
    //
}
---

<div class="grid grid-cols-1 gap-5 sm:grid-cols-2 md:grid-cols-3 py-4" id="lists">
    {lists.length ? lists.map((item: any) => <Card item={item} />) : <div class="text-center col-span-3 py-4">Can't find the "{searchVal}" GPTs</div>}
    {count > pageSize && <div class="col-span-3 text-center">
        <button class="more font-bold text-green-600 underline dark:text-green-400" data-index="2" data-cate="0" data-val={searchVal}>Load More</button>
    </div>}
</div>